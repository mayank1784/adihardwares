<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Add Product</title>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    />
  </head>
  <style>
    input[type="file"] {
      display: none;
    }
    .form-group p {
      text-align: center;
      margin: 20px 0 30px 0;
    }
    #images {
      width: 90%;
      position: relative;
      margin: auto;
      display: flex;
      justify-content: space-evenly;
      gap: 20px;
      flex-wrap: wrap;
    }
    figure {
      width: 45%;
      position: relative;
      margin-bottom: 20px;
    }
    img {
      width: 100%;
    }
    figcaption {
      text-align: center;
      font-size: 2.4vmin;
      margin-top: 0.5vmin;
    }
    .imageLabel {
      display: block;
      position: relative;
      background-color: #de2025;
      color: #ffffff;
      font-size: 18px;
      text-align: center;
      width: 50%;
      padding: 18px 0;
      margin: auto;
      border-radius: 5px;
      cursor: pointer;
    }
    #submitB{
      display: block;
      position: relative;
      background-color: #de2025;
      color: #ffffff;
      font-size: 18px;
      text-align: center;
      width: 50%;
      padding: 18px 0;
      margin: auto;
      border-radius: 5px;
      cursor: pointer;
    }
    .delete-icon {
      position: absolute;
      top: 5px;
      right: 5px;
      background-color: red;
      color: white;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
    }
    .imageLabel:hover,#submitB:hover{
      background-color: #af2220;
    }
    @media (max-width: 768px) {
      figure {
        width: 100%;
      }
    }
  </style>
  <body>
    <div class="container mt-5">
      <div class="row justify-content-center">
        <div class="col-md-8">
          <h1 class="text-center">Submit Image Data Form</h1>
          <form
            id="imageForm"
            action="/api/v1/addProduct"
            method="post"
            enctype="multipart/form-data"
          >
            <div class="form-group">
              <label for="categoryName">Category Name:</label>
              <input
                type="text"
                class="form-control"
                id="categoryName"
                name="categoryName"
                required
              />
            </div>
            <div class="form-group">
              <label for="subcategoryName">Subcategory Name:</label>
              <input
                type="text"
                class="form-control"
                id="subcategoryName"
                name="subcategoryName"
              />
            </div>
            <div class="form-group">
              <label for="subsubcategoryName">Sub-subcategory Name:</label>
              <input
                type="text"
                class="form-control"
                id="subsubcategoryName"
                name="subsubcategoryName"
              />
            </div>
            <div class="form-group">
              <label for="caption">Caption:</label>
              <input
                type="text"
                class="form-control"
                id="caption"
                name="caption"
              />
            </div>
            <div class="form-group">
              <label for="file-input" class="imageLabel">
                <i class="fas fa-upload"></i> &nbsp; Choose Images To Upload
              </label>
              <input
                type="file"
                id="file-input"
                accept="image/png, image/jpeg"
                onchange="preview()"
                multiple
              />

              <p id="num-of-files">No Images Chosen</p>
              <div id="images"></div>
            </div>
            <div class="form-group text-center">
              <button type="submit" class="btn btn-primary" id="submitB">Submit</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <script>
      let selectedFiles = [];
      let fileInput = document.getElementById("file-input");
      let imageContainer = document.getElementById("images");
      let numOfFiles = document.getElementById("num-of-files");

      function updateNumOfFilesText() {
        numOfFiles.textContent = `${selectedFiles.length} Files Selected`;
      }

      function preview() {
        imageContainer.innerHTML = "";
        selectedFiles = [...fileInput.files]; // Store the selected files in the selectedFiles array

        for (let i = 0; i < selectedFiles.length; i++) {
          let reader = new FileReader();
          let figure = document.createElement("figure");
          let figCap = document.createElement("figcaption");
          figCap.innerText = selectedFiles[i].name;

          // Create delete icon and attach click event handler
          let deleteIcon = document.createElement("div");
          deleteIcon.innerHTML = '<i class="fas fa-trash-alt"></i>';
          deleteIcon.classList.add("delete-icon");
          deleteIcon.addEventListener("click", (event) => {
            event.preventDefault();
            event.stopPropagation();
            // Remove the thumbnail and the corresponding file from the selectedFiles array
            imageContainer.removeChild(figure);
            selectedFiles.splice(i, 1);
            updateNumOfFilesText(); // Update the "Files Selected" text after deletion
          });

          figure.appendChild(deleteIcon);
          figure.appendChild(figCap);
          reader.onload = () => {
            let img = document.createElement("img");
            img.setAttribute("src", reader.result);
            figure.insertBefore(img, figCap);
          };
          imageContainer.appendChild(figure);
          reader.readAsDataURL(selectedFiles[i]);
        }

        updateNumOfFilesText(); // Update the "Files Selected" text after selecting new images
      }
    </script>
  </body>
</html>
